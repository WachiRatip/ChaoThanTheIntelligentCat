steps:
  # build the container image
- name: 'gcr.io/cloud-builders/docker'
  args: [
        'build', 
        '-t',
        'gcr.io/$PROJECT_ID/intelligentcat', 
        '.',
        ]
# push the container image to Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/intelligentcat']
  # Deploy container image to Cloud Run
- name: 'gcr.io/cloud-builders/gcloud'
  args: [
        'run', 
        'deploy', 
        'intelligentcat', 
        '--image', 
        'gcr.io/$PROJECT_ID/intelligentcat', 
        '--region', 
        'asia-east1',
        '--platform', 
        'managed', 
        '--quiet',
        '--allow-unauthenticated',
        '--set-env-vars',
        'LINE_CHANNEL_ACCESS_TOKEN=${_LINE_CHANNEL_ACCESS_TOKEN}, LINE_CHANNEL_SECRET=${_LINE_CHANNEL_SECRET}'
        ]

images:
- gcr.io/$PROJECT_ID/intelligentcat
